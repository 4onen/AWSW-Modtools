<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Writing Mods &#8212; AWSW-Modtools  documentation</title>
    
    <link rel="stylesheet" href="_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Documentation" href="documentation.html" />
    <link rel="prev" title="Decompiling the game" href="decompiling.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head>
  <body role="document">
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="writing-mods">
<h1>Writing Mods<a class="headerlink" href="#writing-mods" title="Permalink to this headline">¶</a></h1>
<p>Each mod has two components: the patcher and the additive game code. The patcher will do all the heavily lifting for modification of the game, and the additive game code will be anything that is new to the game.</p>
<p>To construct a mod, see the tree below.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">MyMod</span>
<span class="o">|--</span> <span class="fm">__init__</span><span class="o">.</span><span class="n">py</span>
<span class="o">|--</span> <span class="n">myResource</span><span class="o">.</span><span class="n">rpy</span>
<span class="o">|--</span> <span class="n">resource</span>
    <span class="o">|--</span> <span class="n">custbg</span>
        <span class="o">|--</span> <span class="n">myBackground</span><span class="o">.</span><span class="n">png</span>
</pre></div>
</div>
<p>Any *.rpy file is optional, and will be loaded automatically. The main mod file is mandatory for your mod to be loaded, and <strong>must</strong> be named <code class="docutils literal"><span class="pre">__init__.py</span></code>. Every mod should start with <code class="docutils literal"><span class="pre">from</span> <span class="pre">modloader.modlib</span> <span class="pre">import</span> <span class="pre">base</span> <span class="pre">as</span> <span class="pre">ml</span></code>. This will include all the utilities needed to get started. Using <code class="docutils literal"><span class="pre">modlib</span></code> is as simple as calling functions on <code class="docutils literal"><span class="pre">ml</span></code>. The <code class="docutils literal"><span class="pre">resource</span></code> folder is optional as well. Files in this folder will be loaded into that game as if they were local to the game/ folder or the root of the archive. Should a file have the same name and location as one in the original game, the mod file will override the original.</p>
<p>To get full functionality from the modloader, it is recommended that you inherit from the modclass.Mod class. This will give you access to hooks at various stages during mod loading, and properly inform the user of your mod&#8217;s status. To do this, include <code class="docutils literal"><span class="pre">from</span> <span class="pre">modloader.modclass</span> <span class="pre">import</span> <span class="pre">Mod,</span> <span class="pre">loadable_mod</span></code> at the top of your mod file. Define a class with a decorator as shown below:</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="nd">@loadable_mod</span>
<span class="k">class</span> <span class="nc">AWSWMod</span><span class="p">(</span><span class="n">Mod</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">mod_info</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="s2">&quot;MyModName&quot;</span><span class="p">,</span> <span class="s2">&quot;v0.1&quot;</span><span class="p">,</span> <span class="s2">&quot;AuthorName&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">mod_load</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="c1"># called immediately after loading. Most code should go here.</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">mod_complete</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="c1"># called after all mods are loaded.</span>
        <span class="k">pass</span>
</pre></div>
</div>
<p>However, to make a NSFW mod, it&#8217;s slightly different.</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="nd">@loadable_mod</span>
<span class="k">class</span> <span class="nc">AWSWMod</span><span class="p">(</span><span class="n">Mod</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">mod_info</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="s2">&quot;MyModName&quot;</span><span class="p">,</span> <span class="s2">&quot;v0.1&quot;</span><span class="p">,</span> <span class="s2">&quot;AuthorName&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">mod_load</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="c1"># called immediately after loading. Most code should go here.</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">mod_complete</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="c1"># called after all mods are loaded.</span>
        <span class="k">pass</span>
</pre></div>
</div>
<p>Please notice the tuple has a new fourth element that is True. If the fourth element is True, that indicates to the modloader to display a simple warning to people who want to enable or disable NSFW scenes.</p>
<div class="section" id="python-and-the-dangers-of-rollback">
<h2>Python and the Dangers of Rollback<a class="headerlink" href="#python-and-the-dangers-of-rollback" title="Permalink to this headline">¶</a></h2>
<p>Rollback is an integral feature of Ren&#8217;py, allowing the user to step back in time and make different choices. Usually rollback will play well with mods, but there are some cases that can introduce non-deterministic behavior. The main issue that rollback has is only Python objects encoded in Ren&#8217;Py&#8217;s AST(and then, only a select few statements) are rolled back. For this reason, Python functions should not be used in hooks if you can avoid them.</p>
</div>
<div class="section" id="steam-updates">
<h2>Steam Updates<a class="headerlink" href="#steam-updates" title="Permalink to this headline">¶</a></h2>
<p>The AWSW mod tools do not modify any of the core game files. They will survive and (probably) continue working through most changes to the game&#8217;s code. Hooking via the stable and recommended methods will ensure that a modification to the game&#8217;s code does not break your mod.</p>
</div>
<div class="section" id="how-to-compile-like-a-pro">
<h2>How to compile like a pro.<a class="headerlink" href="#how-to-compile-like-a-pro" title="Permalink to this headline">¶</a></h2>
<p>Instead of manually creating AST Nodes to insert code into the game, or even clunkily creating entries in the rpy language and then jumping to the snippets with the patcher, you can assemble small(or big!) bits of code <em>in-line</em> by abusing the Ren&#8217;py AST Parser. This means you can get a list of objects and insert them wherever with very little effort. We use this method internally to create the mod information menu on the main screen. See the core mod or the dev_test mod for further details.</p>
</div>
<div class="section" id="debugging">
<h2>Debugging<a class="headerlink" href="#debugging" title="Permalink to this headline">¶</a></h2>
<p>There are several obstacles to developing mods for Ren&#8217;py. The first(and biggest) is the fact that the developer has no console to watch for output while running the game! We can fix that by starting AWSW via command line with some switches set. The commands are below.</p>
<p>While in the root directory of the game, run the command for your appropriate operating system:</p>
<div class="section" id="windows">
<h3>Windows<a class="headerlink" href="#windows" title="Permalink to this headline">¶</a></h3>
<p><code class="docutils literal"><span class="pre">&quot;lib/windows-i686/python.exe&quot;</span> <span class="pre">-EO</span> <span class="pre">&quot;Angels</span> <span class="pre">with</span> <span class="pre">Scaly</span> <span class="pre">Wings.py&quot;</span></code></p>
</div>
<div class="section" id="linux-x86-32-bit">
<h3>Linux x86 (32 bit)<a class="headerlink" href="#linux-x86-32-bit" title="Permalink to this headline">¶</a></h3>
<p><code class="docutils literal"><span class="pre">./lib/linux-i686/python</span> <span class="pre">-EO</span> <span class="pre">&quot;Angels</span> <span class="pre">with</span> <span class="pre">Scaly</span> <span class="pre">Wings.py&quot;</span></code></p>
</div>
<div class="section" id="linux-x86-64-64-bit">
<h3>Linux x86_64 (64 bit)<a class="headerlink" href="#linux-x86-64-64-bit" title="Permalink to this headline">¶</a></h3>
<p><code class="docutils literal"><span class="pre">./lib/linux-x86_64/python</span> <span class="pre">-EO</span> <span class="pre">&quot;Angels</span> <span class="pre">with</span> <span class="pre">Scaly</span> <span class="pre">Wings.py&quot;</span></code></p>
<p>Should you print to the console in your code, you may run into an error such as <code class="docutils literal"><span class="pre">LookupError:</span> <span class="pre">unknown</span> <span class="pre">encoding:</span> <span class="pre">cp437</span></code>.
This occurs because you&#8217;re executing a local version of python, which only has utf-8 string encodings loaded in. You can fix this by using <code class="docutils literal"><span class="pre">sprnt</span></code> from <code class="docutils literal"><span class="pre">modlib</span></code> or encoding your string with <code class="docutils literal"><span class="pre">myStr.encode('utf-8')</span></code> before printing.</p>
</div>
</div>
<div class="section" id="sample-code">
<h2>Sample Code<a class="headerlink" href="#sample-code" title="Permalink to this headline">¶</a></h2>
<p>This sample code will remove Kevin&#8217;s encounter and main menu icon. The full mod structure can be found in mods/.</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">renpy</span>
<span class="kn">import</span> <span class="nn">renpy.ast</span> <span class="k">as</span> <span class="nn">ast</span>
<span class="kn">from</span> <span class="nn">modloader</span> <span class="k">import</span> <span class="n">modinfo</span>
<span class="kn">from</span> <span class="nn">modloader.modlib</span> <span class="k">import</span> <span class="n">sprnt</span>
<span class="kn">from</span> <span class="nn">modloader.modlib</span> <span class="k">import</span> <span class="n">base</span> <span class="k">as</span> <span class="n">ml</span> <span class="c1"># ml shortcut</span>
<span class="kn">from</span> <span class="nn">modloader.modclass</span> <span class="k">import</span> <span class="n">Mod</span><span class="p">,</span> <span class="n">loadable_mod</span> <span class="c1"># Import the base class and the decorator</span>

<span class="nd">@loadable_mod</span>
<span class="k">class</span> <span class="nc">AWSWMod</span><span class="p">(</span><span class="n">Mod</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">mod_info</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="s2">&quot;byekevin&quot;</span><span class="p">,</span> <span class="s2">&quot;v0.1&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">mod_load</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">found</span> <span class="o">=</span> <span class="n">ml</span><span class="o">.</span><span class="n">searchPostNode</span><span class="p">(</span><span class="n">ml</span><span class="o">.</span><span class="n">findlabel</span><span class="p">(</span><span class="s2">&quot;c4hatchery&quot;</span><span class="p">),</span> <span class="n">ast</span><span class="o">.</span><span class="n">Scene</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span> <span class="c1"># search max of 20 nodes after c4hatchery label, look for the first scene initialization (which happens to be one opcode away, for now)</span>
        <span class="n">hook</span> <span class="o">=</span> <span class="n">ml</span><span class="o">.</span><span class="n">hook_opcode</span><span class="p">(</span><span class="n">found</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="c1"># insert a hooking node after scene, but before the narrator&#39;s say statement</span>
        <span class="n">hook</span><span class="o">.</span><span class="n">chain</span><span class="p">(</span><span class="n">ml</span><span class="o">.</span><span class="n">searchPostNode</span><span class="p">(</span><span class="n">found</span><span class="p">,</span> <span class="n">ast</span><span class="o">.</span><span class="n">Scene</span><span class="p">))</span> <span class="c1"># normally the hooking node would point back to the dialogue. Skip all the way to the next scene instead.</span>

        <span class="n">mainscr</span> <span class="o">=</span> <span class="n">ml</span><span class="o">.</span><span class="n">getsls</span><span class="p">(</span><span class="s1">&#39;main_menu&#39;</span><span class="p">)</span> <span class="c1"># get the main screen (cache is disabled)</span>
        <span class="n">ml</span><span class="o">.</span><span class="n">nullPyexpr</span><span class="p">(</span><span class="n">mainscr</span><span class="p">,</span> <span class="s1">&#39;persistent.playedkevin&#39;</span><span class="p">)</span> <span class="c1"># remove the if block</span>

        <span class="n">eHooks</span> <span class="o">=</span> <span class="n">ml</span><span class="o">.</span><span class="n">getEndingHooks</span><span class="p">()</span>
        <span class="n">true_search</span> <span class="o">=</span> <span class="n">eHooks</span><span class="o">.</span><span class="n">getPostTrueEndingIzumiScene</span><span class="p">()</span>

        <span class="k">def</span> <span class="nf">kevinCB</span><span class="p">(</span><span class="n">node</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">node</span><span class="o">.</span><span class="n">next</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">next</span><span class="p">,</span> <span class="n">renpy</span><span class="o">.</span><span class="n">ast</span><span class="o">.</span><span class="n">Show</span><span class="p">)</span> <span class="ow">and</span> <span class="n">node</span><span class="o">.</span><span class="n">next</span><span class="o">.</span><span class="n">imspec</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;meetingkevin&#39;</span><span class="p">:</span> <span class="c1"># imspec is part of the image ID in show opcodes.</span>
                <span class="k">return</span> <span class="kc">True</span>

        <span class="n">kevin_credits</span> <span class="o">=</span> <span class="n">ml</span><span class="o">.</span><span class="n">searchPostNodeCB</span><span class="p">(</span><span class="n">true_search</span><span class="p">,</span> <span class="n">kevinCB</span><span class="p">,</span> <span class="mi">800</span><span class="p">)</span> <span class="c1"># search for a node using the kevinCB callback.</span>
        <span class="n">kevin_credits</span><span class="o">.</span><span class="n">chain</span><span class="p">(</span><span class="n">ml</span><span class="o">.</span><span class="n">searchPostNode</span><span class="p">(</span><span class="n">kevin_credits</span><span class="p">,</span> <span class="n">ast</span><span class="o">.</span><span class="n">Scene</span><span class="p">))</span> <span class="c1"># Show and with are separate instructions.</span>
</pre></div>
</div>
<p>See the mods/ and devmods/ folders for further sample code. devmods/ contains a few different examples with fully annotated code.</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Writing Mods</a><ul>
<li><a class="reference internal" href="#python-and-the-dangers-of-rollback">Python and the Dangers of Rollback</a></li>
<li><a class="reference internal" href="#steam-updates">Steam Updates</a></li>
<li><a class="reference internal" href="#how-to-compile-like-a-pro">How to compile like a pro.</a></li>
<li><a class="reference internal" href="#debugging">Debugging</a><ul>
<li><a class="reference internal" href="#windows">Windows</a></li>
<li><a class="reference internal" href="#linux-x86-32-bit">Linux x86 (32 bit)</a></li>
<li><a class="reference internal" href="#linux-x86-64-64-bit">Linux x86_64 (64 bit)</a></li>
</ul>
</li>
<li><a class="reference internal" href="#sample-code">Sample Code</a></li>
</ul>
</li>
</ul>
<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
      <li>Previous: <a href="decompiling.html" title="previous chapter">Decompiling the game</a></li>
      <li>Next: <a href="documentation.html" title="next chapter">Documentation</a></li>
  </ul></li>
</ul>
</div>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/writing_mods.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2017, AWSWCommunity.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.5.5</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.10</a>
      
      |
      <a href="_sources/writing_mods.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>