
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=cp1252" />
    <title>Writing Mods</title>
    <link rel="stylesheet" href="_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="next" title="Documentation" href="documentation.html" />
    <link rel="prev" title="Decompiling the game" href="decompiling.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
          

          <div class="body" role="main">
            
  <div class="section" id="writing-mods">
<h1>Writing Mods</h1>
<p>Each mod has two components: the patcher and the additive game code.
The patcher will do all the heavily lifting for modification of the game, and the additive game code will be anything that is new to the game.</p>
<p>To construct a mod, see the tree below.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">MyMod</span>
<span class="o">|--</span> <span class="fm">__init__</span><span class="o">.</span><span class="n">py</span>
<span class="o">|--</span> <span class="n">myResource</span><span class="o">.</span><span class="n">rpy</span>
<span class="o">|--</span> <span class="n">resource</span>
    <span class="o">|--</span> <span class="n">custbg</span>
        <span class="o">|--</span> <span class="n">myBackground</span><span class="o">.</span><span class="n">png</span>
</pre></div>
</div>
<p>Any *.rpy file is optional, and will be loaded automatically.
The main mod file is mandatory for your mod to be loaded, and <strong>must</strong> be named <code class="docutils literal notranslate"><span class="pre">__init__.py</span></code>.
Every mod should start with <code class="docutils literal notranslate"><span class="pre">from</span> <span class="pre">modloader.modclass</span> <span class="pre">import</span> <span class="pre">loadable_mod,</span> <span class="pre">Mod</span></code>.
This will include all the utilities needed to get started.</p>
<p>Files in the optional <code class="docutils literal notranslate"><span class="pre">resource</span></code> folder will be loaded into that game as if they were local to the game/ folder or the root of the archive.</p>
<p>Inheriting from <a href="#id1"><span class="problematic" id="id2">``</span></a>Mod `` will give you access to hooks at various stages during mod loading, and properly inform the user of your mod’s status.
Define a class with a decorator as shown below:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@loadable_mod</span>
<span class="k">class</span> <span class="nc">AWSWMod</span><span class="p">(</span><span class="n">Mod</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">mod_info</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="s2">&quot;MyModName&quot;</span><span class="p">,</span> <span class="s2">&quot;v0.1&quot;</span><span class="p">,</span> <span class="s2">&quot;AuthorName&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">mod_load</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="c1"># called immediately after loading. Most code should go here.</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">mod_complete</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="c1"># called after all mods are loaded.</span>
        <span class="k">pass</span>
</pre></div>
</div>
<p>However, to make a NSFW mod, it’s slightly different.</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@loadable_mod</span>
<span class="k">class</span> <span class="nc">AWSWMod</span><span class="p">(</span><span class="n">Mod</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">mod_info</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="s2">&quot;MyModName&quot;</span><span class="p">,</span> <span class="s2">&quot;v0.1&quot;</span><span class="p">,</span> <span class="s2">&quot;AuthorName&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">mod_load</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="c1"># called immediately after loading. Most code should go here.</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">mod_complete</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="c1"># called after all mods are loaded.</span>
        <span class="k">pass</span>
</pre></div>
</div>
<p>Please notice the tuple has a new fourth element that is True.
If the fourth element is <code class="docutils literal notranslate"><span class="pre">True</span></code>, that indicates to the modloader to display a simple warning to people who want to enable or disable NSFW scenes.
This notice is <strong>REQUIRED</strong> to have your mod accepted into the Github repository. NSFW mods without the notice will <strong>NOT</strong> be given support.
Note that NSFW mods are not allowed on Steam.</p>
<div class="section" id="python-and-the-dangers-of-rollback">
<h2>Python and the Dangers of Rollback</h2>
<p>Rollback is an integral feature of Ren’py, allowing the user to step back in time and make different choices.
Usually rollback will play well with mods, but there are some cases that can introduce non-deterministic behavior.
The main issue that rollback has is only Python objects encoded in Ren’Py’s AST(and then, only a select few statements) are rolled back.
For this reason, Python functions should not be used in hooks if you can avoid them.</p>
</div>
<div class="section" id="steam-updates">
<h2>Steam Updates</h2>
<p>The AWSW modtools do not modify any of the core game files.
They will survive and (probably) continue working through most changes to the game’s code.
Hooking via the stable and recommended methods will ensure that a modification to the game’s code does not break your mod.</p>
</div>
<div class="section" id="how-to-compile-like-a-pro">
<h2>How to compile like a pro.</h2>
<p>Instead of manually creating AST Nodes to insert code into the game, or even clunkily creating entries in the rpy language and then jumping to the snippets with the patcher, you can assemble small(or big!) bits of code <em>in-line</em> by abusing the Ren’py AST Parser.
This means you can get a list of objects and insert them wherever with very little effort.
We use this method internally to create the mod information menu on the main screen. See the core mod for further details.</p>
</div>
<div class="section" id="debugging">
<h2>Debugging</h2>
<p>There are several obstacles to developing mods for Ren’py.
The first(and biggest) is the fact that the developer has no console to watch for output while running the game!
We can fix that by starting AWSW via command line with some switches set. The commands are below.</p>
<p>While in the root directory of the game, run the command for your appropriate operating system:</p>
<div class="section" id="windows">
<h3>Windows</h3>
<p><code class="docutils literal notranslate"><span class="pre">&quot;lib/windows-i686/python.exe&quot;</span> <span class="pre">-O</span> <span class="pre">&quot;Angels</span> <span class="pre">with</span> <span class="pre">Scaly</span> <span class="pre">Wings.py&quot;</span></code></p>
</div>
<div class="section" id="linux-x86-32-bit">
<h3>Linux x86 (32 bit)</h3>
<p><code class="docutils literal notranslate"><span class="pre">./lib/linux-i686/python</span> <span class="pre">-O</span> <span class="pre">&quot;Angels</span> <span class="pre">with</span> <span class="pre">Scaly</span> <span class="pre">Wings.py&quot;</span></code></p>
</div>
<div class="section" id="linux-x86-64-64-bit">
<h3>Linux x86_64 (64 bit)</h3>
<p><code class="docutils literal notranslate"><span class="pre">./lib/linux-x86_64/python</span> <span class="pre">-O</span> <span class="pre">&quot;Angels</span> <span class="pre">with</span> <span class="pre">Scaly</span> <span class="pre">Wings.py&quot;</span></code></p>
<p>If while printing, you get an error message such as <code class="docutils literal notranslate"><span class="pre">LookupError:</span> <span class="pre">unknown</span> <span class="pre">encoding:</span> <span class="pre">cp437</span></code>, please make sure you are using AwSW v1.7+.</p>
<p>If you are using this version, please report an error on Github or the Steam Forums</p>
</div>
</div>
<div class="section" id="sample-code">
<h2>Sample Code</h2>
<p>This sample code will remove Kevin’s encounter and main menu icon. The full mod structure can be found in mods/.</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="sd">&quot;&quot;&quot;This file is free software under the GPLv3 license&quot;&quot;&quot;</span>
<span class="kn">import</span> <span class="nn">renpy</span>
<span class="kn">import</span> <span class="nn">renpy.ast</span> <span class="k">as</span> <span class="nn">ast</span>

<span class="kn">from</span> <span class="nn">modloader</span> <span class="k">import</span> <span class="n">modinfo</span><span class="p">,</span> <span class="n">modast</span>
<span class="kn">from</span> <span class="nn">modloader.modgame</span> <span class="k">import</span> <span class="n">sprnt</span>
<span class="kn">from</span> <span class="nn">modloader.modgame</span> <span class="k">import</span> <span class="n">base</span> <span class="k">as</span> <span class="n">ml</span>
<span class="kn">from</span> <span class="nn">modloader.modclass</span> <span class="k">import</span> <span class="n">Mod</span><span class="p">,</span> <span class="n">loadable_mod</span>

<span class="nd">@loadable_mod</span>
<span class="k">class</span> <span class="nc">AWSWMod</span><span class="p">(</span><span class="n">Mod</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Removes Kevin from the game&quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">mod_info</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="s2">&quot;byekevin&quot;</span><span class="p">,</span> <span class="s2">&quot;v0.1&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">mod_load</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Find and remove where we find Kevin</span>
        <span class="n">found</span> <span class="o">=</span> <span class="n">modast</span><span class="o">.</span><span class="n">search_for_node_type</span><span class="p">(</span><span class="n">modast</span><span class="o">.</span><span class="n">find_label</span><span class="p">(</span><span class="s2">&quot;c4hatchery&quot;</span><span class="p">),</span> <span class="n">ast</span><span class="o">.</span><span class="n">Scene</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>
        <span class="n">hook</span> <span class="o">=</span> <span class="n">modast</span><span class="o">.</span><span class="n">hook_opcode</span><span class="p">(</span><span class="n">found</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">hook</span><span class="o">.</span><span class="n">chain</span><span class="p">(</span><span class="n">modast</span><span class="o">.</span><span class="n">search_for_node_type</span><span class="p">(</span><span class="n">found</span><span class="p">,</span> <span class="n">ast</span><span class="o">.</span><span class="n">Scene</span><span class="p">))</span>

        <span class="c1"># Remove Kevin from the main screen</span>
        <span class="n">mainscr</span> <span class="o">=</span> <span class="n">modast</span><span class="o">.</span><span class="n">get_slscreen</span><span class="p">(</span><span class="s1">&#39;main_menu&#39;</span><span class="p">)</span>

        <span class="c1"># Remove Kevin from the persistent file</span>
        <span class="n">modast</span><span class="o">.</span><span class="n">remove_slif</span><span class="p">(</span><span class="n">mainscr</span><span class="p">,</span> <span class="s1">&#39;persistent.playedkevin&#39;</span><span class="p">)</span>

        <span class="n">ending_hooks</span> <span class="o">=</span> <span class="n">ml</span><span class="o">.</span><span class="n">get_ending_hooks</span><span class="p">()</span>
        <span class="n">true_search</span> <span class="o">=</span> <span class="n">ending_hooks</span><span class="o">.</span><span class="n">get_post_izumi_node</span><span class="p">()</span>

        <span class="k">def</span> <span class="nf">kevin_cb</span><span class="p">(</span><span class="n">node</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot;Check if ``node`` is the node that we see Kevin</span>
<span class="sd">            Args:</span>
<span class="sd">                node (Node): The current node</span>
<span class="sd">            See also:</span>
<span class="sd">                :meth:`modloader.modlib.AWSWModBase.search_post_node_callback`</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="c1"># Python does short-circuit evaluation; we don&#39;t evaluate the next boolean</span>
            <span class="c1"># statement if the current one isn&#39;t true. So in our case, if node.next is None,</span>
            <span class="c1"># we don&#39;t calculate if node.next is an instance of Show. Similarly, if node.next is</span>
            <span class="c1"># not None but it isn&#39;t an instance of Show, we don&#39;t check the imspec of the object</span>
            <span class="k">if</span> <span class="n">node</span><span class="o">.</span><span class="n">next</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">next</span><span class="p">,</span> <span class="n">renpy</span><span class="o">.</span><span class="n">ast</span><span class="o">.</span><span class="n">Show</span><span class="p">)</span> \
                <span class="ow">and</span> <span class="n">node</span><span class="o">.</span><span class="n">next</span><span class="o">.</span><span class="n">imspec</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;meetingkevin&#39;</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">True</span>

        <span class="n">kevin_credits</span> <span class="o">=</span> <span class="n">modast</span><span class="o">.</span><span class="n">search_for_node_with_criteria</span><span class="p">(</span><span class="n">true_search</span><span class="p">,</span> <span class="n">kevin_cb</span><span class="p">,</span> <span class="mi">800</span><span class="p">)</span>
        <span class="n">kevin_credits</span><span class="o">.</span><span class="n">chain</span><span class="p">(</span><span class="n">modast</span><span class="o">.</span><span class="n">search_for_node_type</span><span class="p">(</span><span class="n">kevin_credits</span><span class="p">,</span> <span class="n">ast</span><span class="o">.</span><span class="n">Scene</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">mod_complete</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span>
</pre></div>
</div>
</div>
</div>


          </div>
          
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2017, AWSWCommunity, 2017-2018 Blue.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.7.6</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.11</a>
      
      |
      <a href="_sources/writing_mods.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>